<!DOCTYPE html>
<!-- saved from url=(0041)https://aif.notion.so/aif-production.html -->
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Notion / App CSS -->
  <link rel="stylesheet" href="./app-bde5b69fca558a00.css">
  <link rel="stylesheet" type="text/css" href="./mainApp-5f55d314f6df5aa4.css">
  <link rel="stylesheet" type="text/css" href="./SidebarComponent-5f55d314f6df5aa4.css">
  <link rel="stylesheet" type="text/css" href="./BlockPropertyRouter-5f55d314f6df5aa4.css">
  <link rel="stylesheet" type="text/css" href="./consoleHelpers-5f55d314f6df5aa4.css">
  <link rel="stylesheet" type="text/css" href="./RecentsCachingListener-5f55d314f6df5aa4.css">

  <!-- ì‚¬ìš©ì CSS override: ëª¨ë“  Notion ìŠ¤íƒ€ì¼ ë¶ˆëŸ¬ì˜¨ ë’¤ ì¶”ê°€ -->
  <style>
    /* ì—ë””í„° ì „ì²´ì— pointer-events ë³µì› */
    [contenteditable] {
      pointer-events: auto !important;
    }
    /* Notion ì˜¤ë²„ë ˆì´ê°€ í´ë¦­ ê°€ë¡œì±„ëŠ” ê²½ìš° ë°©ì§€ */
    .notion-scroller,
    .notion-page-content {
      pointer-events: none !important;
    }
    /* ì €ì¥ ë²„íŠ¼ì€ ìµœìƒìœ„ì—ì„œ í´ë¦­ í—ˆìš© */
    #save-btn {
      pointer-events: auto !important;
      z-index: 10000 !important;
    }
  </style>
</head>
<body>
  <!-- ì—ë””í„° ì˜ì—­ -->
  <div id="collab-editor" contenteditable="true" spellcheck="false" autocorrect="off" autocapitalize="off" style="border:1px solid #ddd; padding:0.5em; min-height:3em; font-family:monospace;">
    <!-- ì´ˆê¸° ë¡œë“œ í›„ ë‚´ìš©ì´ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
  </div>

  <!-- ì›ë˜ ì €ì¥ ë²„íŠ¼ -->
  <button id="save-btn" style="opacity:0.4; margin-top:8px;">ğŸ’¾ ì €ì¥í•˜ê¸°</button>

  <!-- ê°•ì œ í´ë¦­ìš© ìƒˆ ë²„íŠ¼ ì¶”ê°€ -->
  <button id="force-save-btn" style="margin-left:8px; margin-top:8px;">ğŸ‰ ê°•ì œ ì €ì¥ ì‹¤í–‰</button>

  <!-- ìŠ¤í¬ë¦½íŠ¸: ì—ë””í„° ë¡œë”© ë° ì €ì¥ í•¸ë“¤ëŸ¬ -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ”Œ script.js has loaded');
      const API_BASE = 'http://localhost:3000';
      const editor   = document.getElementById('collab-editor');
      const saveBtn  = document.getElementById('save-btn');
      const forceBtn = document.getElementById('force-save-btn');

      if (!editor || !saveBtn || !forceBtn) {
        console.error('âœ–ï¸ collab-editor, save-btn ë˜ëŠ” force-save-btnì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', { editor, saveBtn, forceBtn });
        return;
      }
      console.log('âœ”ï¸ collab-editor, save-btn, force-save-btn ì¤€ë¹„ ì™„ë£Œ');

      // ì„œë²„ì—ì„œ ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°
      fetch(`${API_BASE}/content`)
        .then(res => res.ok ? res.text() : '')
        .then(text => {
          editor.innerText = text;
          console.log('âœ”ï¸ ë¡œë“œëœ ë‚´ìš©:', text);
        })
        .catch(err => console.warn('GET /content ì—ëŸ¬:', err));

      // ì‹¤ì œ ì €ì¥ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
      saveBtn.addEventListener('click', () => {
        const payload = editor.innerText;
        console.log('ğŸ’¾ ì €ì¥ ì¤‘:', payload);
        fetch(`${API_BASE}/content`, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' },
          body: payload
        })
        .then(res => {
          if (res.ok) {
            console.log('âœ”ï¸ ì €ì¥ ì„±ê³µ');
            saveBtn.style.opacity = 0.8;
            setTimeout(() => saveBtn.style.opacity = 0.4, 600);
          } else {
            console.error('ì €ì¥ ì‹¤íŒ¨:', res.status);
          }
        })
        .catch(err => console.error('POST /content ì—ëŸ¬:', err));
      });

      // í¬ìŠ¤ ì„¸ì´ë¸Œ ë²„íŠ¼: ì‹¤ì œ ë²„íŠ¼ ê°•ì œ í´ë¦­
      forceBtn.addEventListener('click', () => {
        saveBtn.click();
        console.log('ğŸ”§ ê°•ì œ í´ë¦­ ì‹¤í–‰: save-btn.click()');
      });
    });
  </script>

  <!-- ë¡œë“œ ì™„ë£Œ í›„ inline pointer-events ì œê±° -->
  <script>
    window.addEventListener('load', () => {
      document.querySelectorAll('[contenteditable]').forEach(el => el.style.pointerEvents = 'auto');
      const btn = document.getElementById('save-btn');
      if (btn) {
        btn.style.pointerEvents = 'auto';
        btn.style.zIndex = '10000';
        console.log('ğŸ›¡ï¸ save-btn pointer-events ë³µì› ì™„ë£Œ');
      }
    });
  </script>

  <!-- ìµœí›„ì˜ ìˆ˜ë‹¨: í´ë¦­ í¬ì›Œë”© íŠ¸ë¦­ -->
  <script>
    document.addEventListener('pointerdown', function(e) {
      const btn = document.getElementById('save-btn');
      if (!btn) return;
      const r = btn.getBoundingClientRect();
      if (
        e.clientX >= r.left && e.clientX <= r.right &&
        e.clientY >= r.top  && e.clientY <= r.bottom
      ) {
        e.preventDefault();
        btn.click();
        console.log('ğŸ¯ í´ë¦­ í¬ì›Œë”©ìœ¼ë¡œ save-btn.click ì‹¤í–‰');
      }
    }, true);
  </script>
</body>
</html>
